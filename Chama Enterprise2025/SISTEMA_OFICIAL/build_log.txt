#0 building with "desktop-linux" instance using docker driver

#1 [internal] load build definition from Dockerfile
#1 transferring dockerfile: 2.03kB done
#1 DONE 0.0s

#2 [internal] load metadata for docker.io/library/node:20.18.1-alpine
#2 DONE 0.3s

#3 [internal] load .dockerignore
#3 transferring context: 343B done
#3 DONE 0.0s

#4 [builder 1/8] FROM docker.io/library/node:20.18.1-alpine@sha256:24fb6aa7020d9a20b00d6da6d1714187c45ed00d1eb4adb01395843c338b9372
#4 resolve docker.io/library/node:20.18.1-alpine@sha256:24fb6aa7020d9a20b00d6da6d1714187c45ed00d1eb4adb01395843c338b9372 0.0s done
#4 CACHED

#5 [builder 2/8] WORKDIR /app
#5 CACHED

#6 [internal] load build context
#6 transferring context: 19.53kB 0.0s done
#6 DONE 0.0s

#7 [builder 3/8] COPY package.json package-lock.json ./
#7 DONE 0.0s

#8 [builder 4/8] COPY client/package.json ./client/
#8 DONE 0.0s

#9 [builder 5/8] COPY server/package.json ./server/
#9 DONE 0.0s

#10 [stage-1 2/9] RUN apk add --no-cache postgresql-client
#10 0.180 fetch https://dl-cdn.alpinelinux.org/alpine/v3.21/main/x86_64/APKINDEX.tar.gz
#10 0.910 fetch https://dl-cdn.alpinelinux.org/alpine/v3.21/community/x86_64/APKINDEX.tar.gz
#10 6.150 (1/8) Installing postgresql-common (1.2-r1)
#10 6.193 Executing postgresql-common-1.2-r1.pre-install
#10 6.209 (2/8) Installing lz4-libs (1.10.0-r0)
#10 6.349 (3/8) Installing libpq (17.7-r0)
#10 6.618 (4/8) Installing ncurses-terminfo-base (6.5_p20241006-r3)
#10 6.659 (5/8) Installing libncursesw (6.5_p20241006-r3)
#10 6.890 (6/8) Installing readline (8.2.13-r0)
#10 7.108 (7/8) Installing zstd-libs (1.5.6-r2)
#10 8.020 (8/8) Installing postgresql17-client (17.7-r0)
#10 ...

#11 [builder 6/8] RUN npm install --include=dev
#11 2.868 npm warn deprecated inflight@1.0.6: This module is not supported, and leaks memory. Do not use it. Check out lru-cache if you want a good and tested way to coalesce async requests by a key value, which is much more comprehensive and powerful.
#11 2.990 npm warn deprecated glob@8.1.0: Glob versions prior to v9 are no longer supported
#11 4.888 npm warn deprecated @esbuild-kit/esm-loader@2.6.5: Merged into tsx: https://tsx.is
#11 4.893 npm warn deprecated @esbuild-kit/core-utils@3.3.2: Merged into tsx: https://tsx.is
#11 8.153 
#11 8.153 added 420 packages, and audited 424 packages in 8s
#11 8.153 
#11 8.153 58 packages are looking for funding
#11 8.153   run `npm fund` for details
#11 8.170 
#11 8.170 5 moderate severity vulnerabilities
#11 8.170 
#11 8.170 To address all issues (including breaking changes), run:
#11 8.170   npm audit fix --force
#11 8.170 
#11 8.170 Run `npm audit` for details.
#11 8.171 npm notice
#11 8.171 npm notice New major version of npm available! 10.8.2 -> 11.7.0
#11 8.171 npm notice Changelog: https://github.com/npm/cli/releases/tag/v11.7.0
#11 8.171 npm notice To update run: npm install -g npm@11.7.0
#11 8.171 npm notice
#11 DONE 8.4s

#12 [builder 7/8] COPY . .
#12 DONE 0.1s

#10 [stage-1 2/9] RUN apk add --no-cache postgresql-client
#10 ...

#13 [builder 8/8] RUN npm run build
#13 0.267 
#13 0.267 > build
#13 0.267 > npm run build --workspace=server && npm run build --workspace=client
#13 0.267 
#13 0.374 
#13 0.374 > rota-verde-server@1.0.0 build
#13 0.374 > tsc
#13 0.374 
#13 ...

#10 [stage-1 2/9] RUN apk add --no-cache postgresql-client
#10 9.640 Executing busybox-1.37.0-r9.trigger
#10 9.643 Executing postgresql-common-1.2-r1.trigger
#10 9.646 * Setting postgresql17 as the default version
#10 9.701 WARNING: opening from cache https://dl-cdn.alpinelinux.org/alpine/v3.21/main: No such file or directory
#10 9.701 WARNING: opening from cache https://dl-cdn.alpinelinux.org/alpine/v3.21/community: No such file or directory
#10 9.704 OK: 15 MiB in 25 packages
#10 DONE 9.8s

#14 [stage-1 3/9] RUN addgroup -g 1001 -S nodejs && adduser -S nodejs -u 1001
#14 DONE 0.3s

#13 [builder 8/8] RUN npm run build
#13 ...

#15 [stage-1 4/9] WORKDIR /app
#15 DONE 0.0s

#16 [stage-1 5/9] COPY package.json package-lock.json ./
#16 DONE 0.1s

#17 [stage-1 6/9] COPY server/package.json ./server/
#17 DONE 0.0s

#18 [stage-1 7/9] RUN npm install --omit=dev
#18 ...

#13 [builder 8/8] RUN npm run build
#13 2.536 
#13 2.536 > rota-verde-client@1.0.0 build
#13 2.536 > vite build
#13 2.536 
#13 2.626 /app/node_modules/rollup/dist/native.js:83
#13 2.626 		throw new Error(
#13 2.626 		      ^
#13 2.626 
#13 2.626 Error: Cannot find module @rollup/rollup-linux-x64-musl. npm has a bug related to optional dependencies (https://github.com/npm/cli/issues/4828). Please try `npm i` again after removing both package-lock.json and node_modules directory.
#13 2.626     at requireWithFriendlyError (/app/node_modules/rollup/dist/native.js:83:9)
#13 2.626     at Object.<anonymous> (/app/node_modules/rollup/dist/native.js:92:76)
#13 2.626     ... 3 lines matching cause stack trace ...
#13 2.626     at Module._load (node:internal/modules/cjs/loader:1104:12)
#13 2.626     at cjsLoader (node:internal/modules/esm/translators:346:17)
#13 2.626     at ModuleWrap.<anonymous> (node:internal/modules/esm/translators:286:7)
#13 2.626     at ModuleJob.run (node:internal/modules/esm/module_job:234:25)
#13 2.626     at async ModuleLoader.import (node:internal/modules/esm/loader:473:24) {
#13 2.626   [cause]: Error: Cannot find module '@rollup/rollup-linux-x64-musl'
#13 2.626   Require stack:
#13 2.626   - /app/node_modules/rollup/dist/native.js
#13 2.626       at Module._resolveFilename (node:internal/modules/cjs/loader:1225:15)
#13 2.626       at Module._load (node:internal/modules/cjs/loader:1051:27)
#13 2.626       at Module.require (node:internal/modules/cjs/loader:1311:19)
#13 2.626       at require (node:internal/modules/helpers:179:18)
#13 2.626       at requireWithFriendlyError (/app/node_modules/rollup/dist/native.js:65:10)
#13 2.626       at Object.<anonymous> (/app/node_modules/rollup/dist/native.js:92:76)
#13 2.626       at Module._compile (node:internal/modules/cjs/loader:1469:14)
#13 2.626       at Module._extensions..js (node:internal/modules/cjs/loader:1548:10)
#13 2.626       at Module.load (node:internal/modules/cjs/loader:1288:32)
#13 2.626       at Module._load (node:internal/modules/cjs/loader:1104:12) {
#13 2.626     code: 'MODULE_NOT_FOUND',
#13 2.626     requireStack: [ '/app/node_modules/rollup/dist/native.js' ]
#13 2.626   }
#13 2.626 }
#13 2.626 
#13 2.626 Node.js v20.18.1
#13 2.630 npm error Lifecycle script `build` failed with error:
#13 2.631 npm error code 1
#13 2.631 npm error path /app/client
#13 2.631 npm error workspace rota-verde-client@1.0.0
#13 2.631 npm error location /app/client
#13 2.631 npm error command failed
#13 2.631 npm error command sh -c vite build
#13 ERROR: process "/bin/sh -c npm run build" did not complete successfully: exit code: 1

#18 [stage-1 7/9] RUN npm install --omit=dev
#18 CANCELED
------
 > [builder 8/8] RUN npm run build:
2.626 }
2.626 
2.626 Node.js v20.18.1
2.630 npm error Lifecycle script `build` failed with error:
2.631 npm error code 1
2.631 npm error path /app/client
2.631 npm error workspace rota-verde-client@1.0.0
2.631 npm error location /app/client
2.631 npm error command failed
2.631 npm error command sh -c vite build
------
Dockerfile:20
--------------------
  18 |     
  19 |     # Build (TypeScript ÔåÆ JavaScript)
  20 | >>> RUN npm run build
  21 |     
  22 |     # ================================================================
--------------------
ERROR: failed to build: failed to solve: process "/bin/sh -c npm run build" did not complete successfully: exit code: 1
